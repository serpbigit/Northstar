<script>
    // Handler for the server-side response
    function showResponse(response) {
        const output = document.getElementById('output');
        // Check for structured response {ok: bool, message: string}
        if (response && response.ok !== undefined) {
             output.innerHTML = response.message;
        } else {
             // Fallback for simple string response from routeUserQuery
             output.innerHTML = response;
        }
    }

    // Main function to send user query
    function sendQuery() {
        var input = document.getElementById('userInput');
        var text = input.value.trim();
        if (text) {
            document.getElementById('output').innerHTML = "ðŸ¤– Polaris is processing your request...";
            // Call the server-side shim function (routeUserQuery)
            google.script.run.withSuccessHandler(showResponse).routeUserQuery(text);
            input.value = ''; // Clear the input after sending
        }
    }

    // Handler for the initial setup button
    function runInitialSetup() {
        document.getElementById('output').innerHTML = "âš™ï¸ Running initial sheet setup...";
        // Call the server-side shim function (setupSheets)
        google.script.run.withSuccessHandler(showResponse).setupSheets();
    }
    
    // Optional: Allow sending query on Enter key press
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('userInput');
      if (input) {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            sendQuery();
          }
        });
      }
    });
</script>
