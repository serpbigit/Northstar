<script>
    console.log("Polaris Client Script Loaded.");
    document.addEventListener('DOMContentLoaded', () => {
        const status = document.getElementById('clientStatus');
        if (status) {
            status.textContent = "Client Status: Ready.";
            console.log("Client Status element updated.");
        }
    });

    // Handler for the server-side response
    function showResponse(response) {
        console.log("Received response:", response);
        const output = document.getElementById('output');
        
        // This is the beginning of the interactive menu logic
        if (response && response.type === "menu") {
            // Future menu rendering logic goes here
            output.innerHTML = "Interactive Menu received, rendering soon.";
        } 
        // Simple response handling
        else if (response && response.ok !== undefined) {
             output.innerHTML = response.message;
        } else {
             output.innerHTML = response;
        }
    }

    // Main function to send user query
    function sendQuery() {
        var input = document.getElementById('userInput');
        var text = input.value.trim();
        if (text) {
            document.getElementById('output').innerHTML = "ðŸ¤– Polaris is processing your request...";
            console.log("Sending query:", text);
            google.script.run.withSuccessHandler(showResponse).routeUserQuery(text);
            input.value = '';
        }
    }

    // Handler for the initial setup button
    function runInitialSetup() {
        document.getElementById('output').innerHTML = "âš™ï¸ Running initial sheet setup...";
        console.log("Calling setupSheets...");
        google.script.run.withSuccessHandler(showResponse).setupSheets();
    }
    
    // Allow sending query on Enter key press
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('userInput');
      if (input) {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            sendQuery();
          }
        });
      }
    });
</script>
